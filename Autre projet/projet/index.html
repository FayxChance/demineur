
<!doctype html>
<html>
<head>
<meta charset="utf-8">
	  <link rel="stylesheet" href="style.css">
	  <script language="Javascript">    
<!--    
//******************************* classe Joueur***********************************
	//function constructeur d'objet joueur
	function Classejoueur(xx,yy){
		// création des variables
		this.x = xx;
		this.y =yy
		this.compteur = 0;
		this.dilueur = 0;
		this.vx = 0;
		this.vy = 0;
		this.ay = -2;
		this.ax = 1;
		this.i_y = yy;
		this.xdeb = xx;
		this.ydeb = yy;
		this.xfin = xx;
		this.yfin = yy;
		this.dx = 0;
		this.dy = 0;
		this.orientation = 1;
		this.coup = 0;
		this.compteur_epee = 0;
		this.etat_sl = 0;
		this.vivant = 1;
		this.respawn_time = 20;
		this.score = 0;
	    // déclaration de la fonction dessiner 
		this.dessiner = function(context){			
			// on dessine le joueur
			if (this.coup == 0)
			{
				if (this.vx > 0)
				{
					this.orientation = 1;
					var img = document.getElementById("sprite");
		  			context.drawImage(img,this.compteur*40,0,40,40,this.x - 20,this.i_y - 40,40,40);
		  			if (this.etat_sl == 1)
		  			{
		  				this.etat_sl = 0;
		  				var snd = document.getElementById("fin_sl");
		  				snd.play();
		  			}
	  			}
	  			if (this.vx < 0)
	  			{
	  				this.orientation = 0;
	  				var img = document.getElementById("sprite_reverse");
	  				context.drawImage(img,this.compteur*40,0,40,40,this.x - 20,this.i_y - 40,40,40);
	  				if (this.etat_sl == 1)
		  			{
		  				this.etat_sl = 0;
		  				var snd = document.getElementById("fin_sl");
		  				snd.play();
		  			}
	  			}
	  			if (this.vx == 0)
				{
					if (this.orientation == 1)
					{
						var img = document.getElementById("sprites_static");
						var img2 = document.getElementById("epee");
			  			context.drawImage(img,this.x - 20,this.i_y - 40,40,40);
			  			context.drawImage(img2,this.x - 1,this.i_y - 10,31,4);
		  			}
		  			else
		  			{
		  				var img = document.getElementById("sprites_static_reverse");
		  				var img2 = document.getElementById("epee_reverse");
		  				context.drawImage(img,this.x - 20,this.i_y - 40,40,40);
		  				context.drawImage(img2,this.x - 31,this.i_y - 10,31,4);
		  			}
		  			if (this.etat_sl == 0)
		  			{
		  				this.etat_sl = 1;
		  				var snd = document.getElementById("debut_sl");
		  				snd.play();
		  			}
	  			}
	  		}
  			if (this.coup == 1){
  				if (this.orientation == 1)
  				{
	  				var img = document.getElementById("sprite_epee");
		  			context.drawImage(img,this.compteur_epee*40,0,40,40,this.x - 20,this.i_y - 40,40,40);
		  			var img2 = document.getElementById("epee");
		  			switch (this.compteur_epee) {
				        case 0:
				        context.drawImage(img2,this.x - 1,this.i_y - 10,31,4);
				        break;
				        case 1:
				        context.drawImage(img2,this.x + 3,this.i_y - 10,31,4);
				        break;
				        case 2:
				        context.drawImage(img2,this.x + 7,this.i_y - 10,31,4);
				        break;
				        case 3:
				        context.drawImage(img2,this.x + 3,this.i_y - 10,31,4);
				        break;
				        case 4:
				        context.drawImage(img2,this.x - 1,this.i_y - 10,31,4);
				        break;}
				}
				else
				{
					var img = document.getElementById("sprite_epee_reverse");
		  			context.drawImage(img,this.compteur_epee*40,0,40,40,this.x - 20,this.i_y - 40,40,40);
		  			var img2 = document.getElementById("epee_reverse");
		  			switch (this.compteur_epee) {
				        case 0:
				        context.drawImage(img2,this.x - 31,this.i_y - 10,31,4);
				        break;
				        case 1:
				        context.drawImage(img2,this.x - 35,this.i_y - 10,31,4);
				        break;
				        case 2:
				        context.drawImage(img2,this.x - 39,this.i_y - 10,31,4);
				        break;
				        case 3:
				        context.drawImage(img2,this.x - 35,this.i_y - 10,31,4);
				        break;
				        case 4:
				        context.drawImage(img2,this.x - 31,this.i_y - 10,31,4);
				        break;}
				}
				    this.compteur_epee = this.compteur_epee + 1;
		  			if (this.compteur_epee == 5)
		  			{
		  				this.compteur_epee = 0;
		  				this.coup = 0;
		  			}
		  		}
  			}
		
		
	}// ---------------------- fin classe joueur

//*********************************** classe simulateur **************************
	// function constructeur d'objet simulateur
	function ClasseSimulateur(){
		// intanciation des 2 joueurs (j1 et j2)
		this.j1 = new Classejoueur(50,60);		
		this.j2 = new Classejoueur(100,80);
		this.univ = new ClasseUnivers();
		
		this.dessiner = function(context){
			// on régénère l'arière plan			
			context.rect(0,0,1000,600);
			context.fillStyle = "#4bc0ff";
			context.fill();
			//on appelle la methode dessiner de l'objet j (de type joueur)
			if (this.j1.vivant == 1)
			{
			this.j1.dessiner(context);
			}
			if (this.j2.vivant == 1)
			{
			this.j2.dessiner(context);
			}
		}
			
	}
//------------------------------fin de la classe simulateur --------------------------------

//*****************************classeUnivers***************************************
	// function constructeur d'objet Univers
	function ClasseUnivers(){
		// création des variables
		this.largeur = document.getElementById("canvasId").width;
		this.hauteur = document.getElementById("canvasId").height;
		document.getElementById
		this.x = new Array();
		this.y = new Array();
		this.nbPoints = 13;
		this.x[1]=0;
		this.y[1]=0;
		this.x[2]=50;
		this.y[2]=0;
		this.x[3]=120;
		this.y[3]=20;
		this.x[4]=160;
		this.y[4]=20;
		this.x[5]=200;
		this.y[5]=0;
		this.x[6]=240;
		this.y[6]=0;
		this.x[7]=260;
		this.y[7]=40;
		this.x[8]=300;
		this.y[8]=40;
		this.x[9]=320;
		this.y[9]=0;
		this.x[10]=400;
		this.y[10]=200;
		this.x[11]=600;
		this.y[11]=120;
		this.x[12]=720;
		this.y[12]=40;
		this.x[13]=1000
		this.y[13]=40;
		
		
		this.dessiner = function(context){
			var i = 0;
			context.beginPath();
			context.strokeStyle='#000000';
			context.moveTo(0,0);
			while (i <= this.nbPoints)
			{
				context.lineTo(this.x[i],this.hauteur - this.y[i]);  
				i = i+1;
			}
			context.stroke();
			context.closePath();
			//on colorie
			context.beginPath();
			context.strokeStyle='#714c36';
			context.moveTo(0,0);
			var j=this.x[1];
			var k=1; //Numéro variables de 1 à nbPoints
			var y=600;
			while (j <= this.x[this.nbPoints]) //Tant que j est inférieur à abscisse dernier point
			{
				if (j >= this.x[k+1])
				{
					k = k+1;
				}
				y =this.hauteur - (((this.y[k+1]-this.y[k])/(this.x[k+1]-this.x[k]))*j + (this.y[k]-((this.y[k+1]-this.y[k])/(this.x[k+1]-this.x[k]))*this.x[k])); //ax + b 
				context.moveTo(j,this.hauteur);
				context.lineTo(j,y);
				j = j+1;
			}
			context.stroke();
			context.closePath();
			
		}
		
		
		
	}



window.onload = function()
{   
	//*************************** zoe de définition des fonctions **************

	function allerDroite(){
		sim.j1.vx = sim.j1.vx + 5;
	}
	function allerGauche(){
		sim.j1.vx = sim.j1.vx - 5;
	}
	function sauter(){
		sim.j1.vy = sim.j1.vy + 10;
	}
	function coup_epee(){
		var snd = document.getElementById("sl");
		snd.play();
		if (sim.j2.y + 20)
		if (sim.j1.orientation == 1 && sim.j1.vivant == 1)
		{
			if ((sim.j1.x + 37) > sim.j2.x - 8 && sim.j1.x < sim.j2.x && sim.j2.vivant == 1 && sim.j1.coup == 0)
			{
				sim.j2.vivant = 0;
				sim.j1.score = sim.j1.score + 1;
			}
		}
		else
		{
			if ((sim.j1.x - 37) < sim.j2.x + 8 && sim.j1.x > sim.j2.x && sim.j2.vivant == 1 && sim.j1.coup == 0 && sim.j1.vivant == 1)
			{
				sim.j2.vivant = 0;
				sim.j1.score = sim.j1.score + 1;
			}
		}
		sim.j1.coup = 1;
	}
	function allerDroite2(){
		sim.j2.vx = sim.j2.vx + 5;
	}
	function allerGauche2(){
		sim.j2.vx = sim.j2.vx - 5;
	}
	function sauter2(){
		sim.j2.vy = sim.j2.vy + 10;
	}
	function coup_epee2(){
		var snd = document.getElementById("sl");
		snd.play();
		if (sim.j2.orientation == 1 && sim.j2.vivant == 1)
		{
			if ((sim.j2.x + 37) > sim.j1.x - 8 && sim.j2.x < sim.j1.x && sim.j1.vivant == 1 && sim.j2.coup == 0)
			{
				sim.j1.vivant = 0;
				sim.j2.score = sim.j2.score + 1;
			}
		}
		else
		{
			if ((sim.j2.x - 37) < sim.j1.x + 8 && sim.j2.x > sim.j1.x && sim.j1.vivant == 1 && sim.j2.coup == 0 && sim.j2.vivant == 1)
			{
				sim.j1.vivant = 0;
				sim.j2.score = sim.j2.score + 1;
			}
		}
		sim.j2.coup = 1;
	}
  // la fonction évoluer n'est pas appelé immédiatement lors du chargement mais seulement par le timer	
  
  function evoluer()
    {
        // puis demande au simulateur de se dessiner
        sim.dessiner(context);
		//puis a l'univers
		sim.univ.dessiner(context);
        // puis affiche le sens de deplacement du j1
		document.getElementById("score1").innerHTML = sim.j1.score;
		document.getElementById("score2").innerHTML = sim.j2.score;
		//on verifie si les joueurs sont vivants
		if ((sim.j1.vivant == 0) && (sim.j1.respawn_time >= 19))
		{
			var snd = document.getElementById("cdw");
		  	snd.play();
		}
		if ((sim.j2.vivant == 0) && (sim.j2.respawn_time == 20))
		{
			var snd = document.getElementById("cdw");
		  	snd.play();
		}
		if (sim.j1.vivant == 0)
		{
			sim.j1.respawn_time = sim.j1.respawn_time - 1;
			document.getElementById("rs1").style = "display:block;";
			document.getElementById("rs1").innerHTML = "temps respawn j1: " + sim.j1.respawn_time;
		}
		else
		{
			document.getElementById("rs1").style = "display:none;";
		}
		if (sim.j1.respawn_time <= 0)
		{
			sim.j1.vivant = 1;
			sim.j1.respawn_time = 20;
		}

		if (sim.j2.vivant == 0)
		{
			sim.j2.respawn_time = sim.j2.respawn_time - 1;
			document.getElementById("rs2").style = "display:block;";
			document.getElementById("rs2").innerHTML = "temps respawn j2: " + sim.j2.respawn_time;
		}
		else
		{
			document.getElementById("rs2").style = "display:none;";
		}
		if (sim.j2.respawn_time <= 0)
		{
			sim.j2.vivant = 1;
			sim.j2.respawn_time = 20;
		}
		//on regarde qui gagne
		if (sim.j1.score > sim.j2.score)
		{
			document.getElementById("crown_j1").style ="display: inline-block;";
			document.getElementById("crown_j2").style ="display: none;";
		}
		else if (sim.j2.score > sim.j1.score)
		{
			document.getElementById("crown_j2").style ="display: inline-block;";
			document.getElementById("crown_j1").style ="display: none;";
		}
		else
		{
			document.getElementById("crown_j1").style ="display: none;";
			document.getElementById("crown_j2").style ="display: none;";
		}
		//on calcul la sprite de j1
		var x_pur = sim.j1.x;
		while (x_pur >= 220)
		{
			x_pur = x_pur - 220;
		}
		sim.j1.compteur = Math.round(x_pur*8/220);
		//on calcul la sprite de j2
		var x_pur = sim.j2.x;
		while (x_pur >= 220)
		{
			x_pur = x_pur - 220;
		}
		sim.j2.compteur = Math.round(x_pur*8/220);
		//on calcule la vitesse des joueurs
		sim.j1.vy = sim.j1.vy + sim.j1.ay;
		sim.j2.vy = sim.j2.vy + sim.j2.ay;
		if (sim.j1.vx != 0)
		{
			if (sim.j1.vx < 0)
			{
				sim.j1.vx = sim.j1.vx +1;
			}
			else{
				sim.j1.vx = sim.j1.vx -1;
			}
		}
		if (sim.j2.vx != 0)
		{
			if (sim.j2.vx < 0)
			{
				sim.j2.vx = sim.j2.vx +1;
			}
			else{
				sim.j2.vx = sim.j2.vx -1;
			}
		}
		//on affecte les deplacements des joueurs
		sim.j1.xdeb = sim.j1.x;
		sim.j1.ydeb = sim.j1.y;
		sim.j2.xdeb = sim.j2.x;
		sim.j2.ydeb = sim.j2.y;
		sim.j1.x = sim.j1.x + sim.j1.vx;
		sim.j1.y = sim.j1.y + sim.j1.vy;
		sim.j2.x = sim.j2.x + sim.j2.vx;
		sim.j2.y = sim.j2.y + sim.j2.vy;
		//on tient compte de la map pour j1
		var n= 100;
		var i = 1;
		var j = 0;
		var k = 1;
		var y = 0;
		sim.j1.xfin = sim.j1.xdeb;
		sim.j1.yfin = sim.j1.ydeb;
		sim.j1.dx = (sim.j1.x - sim.j1.xdeb)/n;
		sim.j1.dy = (sim.j1.y - sim.j1.ydeb)/n;
		while (i <= n)
		{
			while (sim.univ.x[k+1] < sim.j1.xdeb + i*sim.j1.dx) //Tant que j est inférieur à abscisse k
				{
					k = k + 1;
				}
			y =((sim.univ.y[k+1]-sim.univ.y[k])/(sim.univ.x[k+1]-sim.univ.x[k]))*(sim.j1.xdeb + i*sim.j1.dx) + (sim.univ.y[k]-((sim.univ.y[k+1]-sim.univ.y[k])/(sim.univ.x[k+1]-sim.univ.x[k]))*sim.univ.x[k]); //ax + b 
			if (sim.j1.ydeb + i*sim.j1.dy > y)
			{
				sim.j1.xfin = sim.j1.xdeb + i*sim.j1.dx;
				sim.j1.yfin = sim.j1.ydeb + i*sim.j1.dy + 1;
				i = i +1;
			}
			else{
				sim.j1.vy = 0;
				i = n + 1;
			}
			k=0;
		}
		sim.j1.x = sim.j1.xfin;
		sim.j1.y = sim.j1.yfin;
		//on tient compte de la map pour j2
		var n2= 100;
		var i2 = 1;
		var j2 = 0;
		var k2 = 1;
		var y2 = 0;
		sim.j2.xfin = sim.j2.xdeb;
		sim.j2.yfin = sim.j2.ydeb;
		sim.j2.dx = (sim.j2.x - sim.j2.xdeb)/n2;
		sim.j2.dy = (sim.j2.y - sim.j2.ydeb)/n2;
		while (i2 <= n2)
		{
			while (sim.univ.x[k2+1] < sim.j2.xdeb + i2*sim.j2.dx) //Tant que j2 est inférieur à abscisse k
				{
					k2 = k2 + 1;
				}
			y2 =((sim.univ.y[k2+1]-sim.univ.y[k2])/(sim.univ.x[k2+1]-sim.univ.x[k2]))*(sim.j2.xdeb + i*sim.j2.dx) + (sim.univ.y[k2]-((sim.univ.y[k2+1]-sim.univ.y[k2])/(sim.univ.x[k2+1]-sim.univ.x[k2]))*sim.univ.x[k2]); //ax + b 
			if (sim.j2.ydeb + i2*sim.j2.dy > y2)
			{
				sim.j2.xfin = sim.j2.xdeb + i2*sim.j2.dx;
				sim.j2.yfin = sim.j2.ydeb + i2*sim.j2.dy + 1;
				i2 = i2 +1;
			}
			else{
				sim.j2.vy = 0;
				i2 = n2 + 1;
			}
			k=0;
		}
		sim.j2.x = sim.j2.xfin;
		sim.j2.y = sim.j2.yfin;
		//on impose une vitesse limite pour j1
		if (sim.j1.vx > 20)
		{
			sim.j1.vx = 20;
		}
		if (sim.j1.vx < -20)
		{
			sim.j1.vx = -20;
		}
		//on impose une vitesse limite pour j2
		if (sim.j2.vx > 20)
		{
			sim.j2.vx = 20;
		}
		if (sim.j2.vx < -20)
		{
			sim.j2.vx = -20;
		}
		
		//on empeche les joueurs de sortir du monde
		if (sim.j1.y <= 0){
			sim.j1.y = 20;
			sim.j1.vy = 20;
		}
		if (sim.j2.y <= 0){
			sim.j2.y = 20;
			sim.j2.vy = 0;
		}
		// on empeche les joueurs de bouger si ils mettent un coup dépee
		if (sim.j1.coup == 1)
		{
			sim.j1.vx = 0;
		}
		//on inverse le repère
		sim.j1.i_y = document.getElementById("canvasId").height - sim.j1.y;
		sim.j2.i_y = document.getElementById("canvasId").height - sim.j2.y;
    }
  //******************* fin definition des fonctions**************  
  //************************************************************** 
  //	debutdu code exécuté au chargement de la page
  //**************************************************************
  
  var monCanevas = document.getElementById("canvasId");
  // tout est mis dans un if getContext de monCanevas afin d'éviter les plantage si canvas n'est pas géré par le navigateur
  if (monCanevas.getContext){

    var context= monCanevas.getContext("2d"); 
 
     
    // instancie(construit) un jeu  nommé  j
    var sim = new ClasseSimulateur();
    
    
    // definition du timer en ms et de la fonction appellée par le timer
    // ATTENTION : pas de parenthèses pour la fonction appelée
    // le jeu est redessiné toutes les 30 ms
    var myInterval = setInterval(evoluer, 50);
    // gestionnaire d'événement
    if (sim.j2.vivant == 1)
    {
	document.monForm.boutonDroite.onclick=allerDroite2;
	document.monForm.boutonGauche.onclick=allerGauche2;
	document.monForm.boutonSauter.onclick=sauter2;
	document.monForm.boutonCoup.onclick=coup_epee2;
	}
	window.onkeydown = function(event) {
		if (sim.j1.vivant == 1)
		{
		    switch (event.keyCode) {
		        case 81: /* q */
		        allerGauche();
		        break;
		        case 90: /* z */ 
		        sauter();
		        break;
		        case 68: /* d */
		        allerDroite();
		        break;
		        case 65: /* a */
		        coup_epee();
		        break;
				}
		}
  }     // fin de   if (monCanevas.getContext)
   
}    //   fin de window.onload = function()

}

-->    
</script>
</head>
<body>
  <canvas id="canvasId" width="1000" height="600" name="monCanevas">
	  Texte si navigateur ne supporte pas la balise Canvas
  </canvas>
      <div id="s1"><img id="crown_j1" src="ressources/images/crown.png"><br/>score j1 <h1 id="score1"></h1></div><br> 
      <div id="s2"><img id="crown_j2" src="ressources/images/crown.png"><br/>score j2 <h1 id="score2"></h1></div><br>
      <div id="rs1"><br/></div>
      <div id="rs2"><br/></div>
  <form name="monForm" id ="monForm">
	  <input value="" id="fh" name="boutonSauter" type="button" >  <br/>
	  <input value="" id="fg" name="boutonGauche" type="button" > 
	  <input value="" id="fd" name="boutonDroite" type="button" > <br/>
	  <input value="" id="fc" name="boutonCoup" type="button" > 
  </form>
  <img id="sprite" width="220" height="277" src="ressources/images/sprites.png" alt="sprite" style="display: none;">
  <img id="sprite_reverse" width="220" height="277" src="ressources/images/sprites_reverse.png" alt="sprite"  style="display: none;">
  <img id="sprites_static" width="220" height="277" src="ressources/images/sprites_static.png" alt="sprite"  style="display: none;">
  <img id="sprites_static_reverse" width="220" height="277" src="ressources/images/sprites_static_reverse.png" alt="sprite"  style="display: none;">
  <img id="sprite_epee" width="220" height="277" src="ressources/images/sprite_sword.png" alt="sprite"  style="display: none;">
  <img id="epee" width="220" height="277" src="ressources/images/sword.png" alt="sprite"  style="display: none;">
  <img id="sprite_epee_reverse" width="220" height="277" src="ressources/images/sprite_sword_reverse.png" alt="sprite"  style="display: none;">
  <img id="epee_reverse" width="220" height="277" src="ressources/images/sword_reverse.png" alt="sprite"  style="display: none;">
  <audio id="debut_sl" >
  		<source src="ressources/son/debut_sl.wav">
  </audio>
  <audio id="fin_sl" >
  		<source src="ressources/son/fin_sl.wav">
  </audio>
  <audio id="sl" >
  		<source src="ressources/son/sl.wav">
  </audio>
  <audio id="cdw" >
  		<source src="ressources/son/cri_de_wilhelm.wav">
  </audio>
</html>