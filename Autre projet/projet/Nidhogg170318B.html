
<!doctype html>
<html>
<head>
<meta charset="utf-8">
	  <link rel="stylesheet" href="style.css">
	  <script language="Javascript">    
<!--    
//******************************* classe Shadok***********************************
	//function constructeur d'objet shadok
	function ClasseShadok(xx,yy,coul){
		// création des variables
		this.x = xx;
		this.y =yy
		this.ouverture = 0;
		this.sens= 1;
		this.mouvement =1;
		this.min = 0;
		this.max = 8;
		this.interval= 25;
		this.compteur = 0;
		this.dilueur = 0;
		this.vx = 0;
		this.vy = 0;
		this.ay = -2;
		this.ax = 1;
		this.i_y = yy;
		this.xdeb = xx;
		this.ydeb = yy;
		this.xfin = xx;
		this.yfin = yy;
		this.dx = 0;
		this.dy = 0;
		this.orientation = 1;
		this.coup = 0;
		this.compteur_epee = 0;
		this.etat_sl = 0;
		this.vivant = 1;
		this.respawn_time = 100;
		this.score = 0;
	    // déclaration de la fonction dessiner 
		this.dessiner = function(context){			
			// on dessine le shadok
			if (this.coup == 0)
			{
				if (this.vx > 0)
				{
					this.orientation = 1;
					var img = document.getElementById("sprite");
		  			context.drawImage(img,this.compteur*40,0,40,40,this.x - 20,this.i_y - 40,40,40);
		  			if (this.etat_sl == 1)
		  			{
		  				this.etat_sl = 0;
		  				var snd = document.getElementById("fin_sl");
		  				snd.play();
		  			}
	  			}
	  			if (this.vx < 0)
	  			{
	  				this.orientation = 0;
	  				var img = document.getElementById("sprite_reverse");
	  				context.drawImage(img,this.compteur*40,0,40,40,this.x - 20,this.i_y - 40,40,40);
	  				if (this.etat_sl == 1)
		  			{
		  				this.etat_sl = 0;
		  				var snd = document.getElementById("fin_sl");
		  				snd.play();
		  			}
	  			}
	  			if (this.vx == 0)
				{
					if (this.orientation == 1)
					{
						var img = document.getElementById("sprites_static");
						var img2 = document.getElementById("epee");
			  			context.drawImage(img,this.x - 20,this.i_y - 40,40,40);
			  			context.drawImage(img2,this.x - 1,this.i_y - 10,31,4);
		  			}
		  			else
		  			{
		  				var img = document.getElementById("sprites_static_reverse");
		  				var img2 = document.getElementById("epee_reverse");
		  				context.drawImage(img,this.x - 20,this.i_y - 40,40,40);
		  				context.drawImage(img2,this.x - 31,this.i_y - 10,31,4);
		  			}
		  			if (this.etat_sl == 0)
		  			{
		  				this.etat_sl = 1;
		  				var snd = document.getElementById("debut_sl");
		  				snd.play();
		  			}
	  			}
	  		}
  			if (this.coup == 1){
  				if (this.orientation == 1)
  				{
	  				var img = document.getElementById("sprite_epee");
		  			context.drawImage(img,this.compteur_epee*40,0,40,40,this.x - 20,this.i_y - 40,40,40);
		  			var img2 = document.getElementById("epee");
		  			switch (this.compteur_epee) {
				        case 0:
				        context.drawImage(img2,this.x - 1,this.i_y - 10,31,4);
				        break;
				        case 1:
				        context.drawImage(img2,this.x + 3,this.i_y - 10,31,4);
				        break;
				        case 2:
				        context.drawImage(img2,this.x + 7,this.i_y - 10,31,4);
				        break;
				        case 3:
				        context.drawImage(img2,this.x + 3,this.i_y - 10,31,4);
				        break;
				        case 4:
				        context.drawImage(img2,this.x - 1,this.i_y - 10,31,4);
				        break;}
				}
				else
				{
					var img = document.getElementById("sprite_epee_reverse");
		  			context.drawImage(img,this.compteur_epee*40,0,40,40,this.x - 20,this.i_y - 40,40,40);
		  			var img2 = document.getElementById("epee_reverse");
		  			switch (this.compteur_epee) {
				        case 0:
				        context.drawImage(img2,this.x - 31,this.i_y - 10,31,4);
				        break;
				        case 1:
				        context.drawImage(img2,this.x - 35,this.i_y - 10,31,4);
				        break;
				        case 2:
				        context.drawImage(img2,this.x - 39,this.i_y - 10,31,4);
				        break;
				        case 3:
				        context.drawImage(img2,this.x - 35,this.i_y - 10,31,4);
				        break;
				        case 4:
				        context.drawImage(img2,this.x - 31,this.i_y - 10,31,4);
				        break;}
				}
				    this.compteur_epee = this.compteur_epee + 1;
		  			if (this.compteur_epee == 5)
		  			{
		  				this.compteur_epee = 0;
		  				this.coup = 0;
		  			}
		  		}
  			}
		this.claquerDesDents = function(){
			this.ouverture=this.ouverture +(this.mouvement * this.sens);
			if( this.ouverture>=this.max)
			{
				this.ouverture=this.max;
				this.sens =-1;
			}
			if( this.ouverture<=this.min)
			{
				this.ouverture=this.min;
				this.sens =1;
			}
		}
		
		
	}// ---------------------- fin classe Shadok

//*********************************** classe simulateur **************************
	// function constructeur d'objet simulateur
	function ClasseSimulateur(){
		// intanciation des 2 shadoks (shad1 et shad2)
		this.shad1 = new ClasseShadok(50,60,"#0000ff");		
		this.shad2 = new ClasseShadok(100,80,"#ff0000");
		this.univ = new ClasseUnivers();
		
		this.dessiner = function(context){
			// on régénère l'arière plan			
			context.rect(0,0,1000,600);
			context.fillStyle = "#ffff00"; 
			context.fill();
			//on appelle la methode dessiner de l'objet shad (de type shadok)
			if (this.shad1.vivant == 1)
			{
			this.shad1.dessiner(context);
			}
			if (this.shad2.vivant == 1)
			{
			this.shad2.dessiner(context);
			}
		}
			
	}
//------------------------------fin de la classe simulateur --------------------------------

//*****************************classeUnivers***************************************
	// function constructeur d'objet Univers
	function ClasseUnivers(){
		// création des variables
		this.largeur = document.getElementById("canvasId").width;
		this.hauteur = document.getElementById("canvasId").height;
		document.getElementById
		this.x = new Array();
		this.y = new Array();
		this.nbPoints = 2;
		this.x[1]=0;
		this.y[1]=50;
		this.x[2]=1001;
		this.y[2]=50;
		/*this.x[3]=120;
		this.y[3]=20;
		this.x[4]=160;
		this.y[4]=20;
		this.x[5]=200;
		this.y[5]=0;
		this.x[6]=240;
		this.y[6]=0;
		this.x[7]=260;
		this.y[7]=40;
		this.x[8]=300;
		this.y[8]=40;
		this.x[9]=320;
		this.y[9]=0;
		this.x[10]=400;
		this.y[10]=200;
		this.x[11]=600;
		this.y[11]=120;
		this.x[12]=720;
		this.y[12]=40;*/
		
		
		this.dessiner = function(context){
			var i = 0;
			context.beginPath();
			context.strokeStyle='#000000';
			context.moveTo(0,0);
			while (i <= this.nbPoints)
			{
				context.lineTo(this.x[i],this.hauteur - this.y[i]);  
				i = i+1;
			}
			context.stroke();
			context.closePath();
			//on colorie
			context.beginPath();
			context.strokeStyle='#ff0000';
			context.moveTo(0,0);
			var j=this.x[1];
			var k=1; //Numéro variables de 1 à nbPoints
			var y=600;
			while (j <= this.x[this.nbPoints]) //Tant que j est inférieur à abscisse dernier point
			{
				if (j >= this.x[k+1])
				{
					k = k+1;
				}
				y =this.hauteur - (((this.y[k+1]-this.y[k])/(this.x[k+1]-this.x[k]))*j + (this.y[k]-((this.y[k+1]-this.y[k])/(this.x[k+1]-this.x[k]))*this.x[k])); //ax + b 
				context.moveTo(j,this.hauteur);
				context.lineTo(j,y);
				j = j+1;
			}
			context.stroke();
			context.closePath();
			
		}
		
		
		
	}



window.onload = function()
{   
	//*************************** zoe de définition des fonctions **************
	

	
	function arreter(){
	    sim.shad1.mouvement=0;		
	}	
	function relancer(){
		sim.shad1.mouvement=1;
	}	
	function allerDroite(){
		sim.shad1.vx = sim.shad1.vx + 5;
	}
	function allerGauche(){
		sim.shad1.vx = sim.shad1.vx - 5;
	}
	function sauter(){
		sim.shad1.vy = sim.shad1.vy + 10;
	}
	function coup_epee(){
		sim.shad1.coup = 1;
		var snd = document.getElementById("sl");
		snd.play();
		if (sim.shad2.y + 20)
		if (sim.shad1.orientation == 1)
		{
			if ((sim.shad1.x + 37) > sim.shad2.x - 8 && sim.shad1.x < sim.shad2.x)
			{
				sim.shad2.vivant = 0;
				sim.shad1.score = sim.shad1.score + 1;
			}
		}
		else
		{
			if ((sim.shad1.x - 37) < sim.shad2.x + 8 && sim.shad1.x > sim.shad2.x)
			{
				sim.shad2.vivant = 0;
				sim.shad1.score = sim.shad1.score + 1;
			}
		}
	}
	function allerDroite2(){
		sim.shad2.vx = sim.shad2.vx + 5;
	}
	function allerGauche2(){
		sim.shad2.vx = sim.shad2.vx - 5;
	}
	function sauter2(){
		sim.shad2.vy = sim.shad2.vy + 10;
	}
	function coup_epee2(){
		sim.shad2.coup = 1;
		var snd = document.getElementById("sl");
		snd.play();
		if (sim.shad2.orientation == 1)
		{
			if ((sim.shad2.x + 37) > sim.shad1.x - 8 && sim.shad2.x < sim.shad1.x)
			{
				sim.shad1.vivant = 0;
				sim.shad2.score = sim.shad2.score + 1;
			}
		}
		else
		{
			if ((sim.shad2.x - 37) < sim.shad1.x + 8 && sim.shad2.x > sim.shad1.x)
			{
				sim.shad1.vivant = 0;
				sim.shad2.score = sim.shad2.score + 1;
			}
		}
	}
  // la fonction évoluer n'est pas appelé immédiatement lors du chargement mais seulement par le timer	
  
  function evoluer()
    {    
        // la fonction evoluer demande aux 2 shados de claquer des dents
        sim.shad1.claquerDesDents();
        sim.shad2.claquerDesDents();
        // puis demande au simulateur de se dessiner
        sim.dessiner(context);
		//puis a l'univers
		sim.univ.dessiner(context);
        // puis affiche le sens de deplacement du shad1
		document.getElementById("score1").innerHTML = sim.shad1.score;
		document.getElementById("score2").innerHTML = sim.shad2.score;
		//on verifie si les shadocks sont vivants
		if (sim.shad1.vivant == 0)
		{
			sim.shad1.respawn_time = sim.shad1.respawn_time - 1;
			document.getElementById("rs1").style = "display:block;";
			document.getElementById("rs1").innerHTML = "temps respawn j1: " + sim.shad1.respawn_time;
		}
		else
		{
			document.getElementById("rs1").style = "display:none;";
		}
		if (sim.shad1.respawn_time <= 0)
		{
			sim.shad1.vivant = 1;
			sim.shad1.respawn_time = 100;
		}

		if (sim.shad2.vivant == 0)
		{
			sim.shad2.respawn_time = sim.shad2.respawn_time - 1;
			document.getElementById("rs2").style = "display:block;";
			document.getElementById("rs2").innerHTML = "temps respawn j2: " + sim.shad2.respawn_time;
		}
		else
		{
			document.getElementById("rs2").style = "display:none;";
		}
		if (sim.shad2.respawn_time <= 0)
		{
			sim.shad2.vivant = 1;
			sim.shad2.respawn_time = 100;
		}
		//on calcul la sprite de shad1
		var x_pur = sim.shad1.x;
		while (x_pur >= 220)
		{
			x_pur = x_pur - 220;
		}
		sim.shad1.compteur = Math.round(x_pur*8/220);
		//on calcul la sprite de shad2
		var x_pur = sim.shad2.x;
		while (x_pur >= 220)
		{
			x_pur = x_pur - 220;
		}
		sim.shad2.compteur = Math.round(x_pur*8/220);
		//on calcule la vitesse des shadoks
		sim.shad1.vy = sim.shad1.vy + sim.shad1.ay;
		sim.shad2.vy = sim.shad2.vy + sim.shad2.ay;
		if (sim.shad1.vx != 0)
		{
			if (sim.shad1.vx < 0)
			{
				sim.shad1.vx = sim.shad1.vx +1;
			}
			else{
				sim.shad1.vx = sim.shad1.vx -1;
			}
		}
		if (sim.shad2.vx != 0)
		{
			if (sim.shad2.vx < 0)
			{
				sim.shad2.vx = sim.shad2.vx +1;
			}
			else{
				sim.shad2.vx = sim.shad2.vx -1;
			}
		}
		//on affecte les deplacements des shadocks
		sim.shad1.xdeb = sim.shad1.x;
		sim.shad1.ydeb = sim.shad1.y;
		sim.shad2.xdeb = sim.shad2.x;
		sim.shad2.ydeb = sim.shad2.y;
		sim.shad1.x = sim.shad1.x + sim.shad1.vx;
		sim.shad1.y = sim.shad1.y + sim.shad1.vy;
		sim.shad2.x = sim.shad2.x + sim.shad2.vx;
		sim.shad2.y = sim.shad2.y + sim.shad2.vy;
		//on tient compte de la map pour shad1
		var n= 100;
		var i = 1;
		var j = 0;
		var k = 1;
		var y = 0;
		sim.shad1.xfin = sim.shad1.xdeb;
		sim.shad1.yfin = sim.shad1.ydeb;
		sim.shad1.dx = (sim.shad1.x - sim.shad1.xdeb)/n;
		sim.shad1.dy = (sim.shad1.y - sim.shad1.ydeb)/n;
		while (i <= n)
		{
			while (sim.univ.x[k+1] < sim.shad1.xdeb + i*sim.shad1.dx) //Tant que j est inférieur à abscisse k
				{
					k = k + 1;
				}
			y =((sim.univ.y[k+1]-sim.univ.y[k])/(sim.univ.x[k+1]-sim.univ.x[k]))*(sim.shad1.xdeb + i*sim.shad1.dx) + (sim.univ.y[k]-((sim.univ.y[k+1]-sim.univ.y[k])/(sim.univ.x[k+1]-sim.univ.x[k]))*sim.univ.x[k]); //ax + b 
			if (sim.shad1.ydeb + i*sim.shad1.dy > y)
			{
				sim.shad1.xfin = sim.shad1.xdeb + i*sim.shad1.dx;
				sim.shad1.yfin = sim.shad1.ydeb + i*sim.shad1.dy + 1;
				i = i +1;
			}
			else{
				sim.shad1.vy = 0;
				i = n + 1;
			}
			k=0;
		}
		sim.shad1.x = sim.shad1.xfin;
		sim.shad1.y = sim.shad1.yfin;
		//on tient compte de la map pour shad2
		var n2= 100;
		var i2 = 1;
		var j2 = 0;
		var k2 = 1;
		var y2 = 0;
		sim.shad2.xfin = sim.shad2.xdeb;
		sim.shad2.yfin = sim.shad2.ydeb;
		sim.shad2.dx = (sim.shad2.x - sim.shad2.xdeb)/n2;
		sim.shad2.dy = (sim.shad2.y - sim.shad2.ydeb)/n2;
		while (i2 <= n2)
		{
			while (sim.univ.x[k2+1] < sim.shad2.xdeb + i2*sim.shad2.dx) //Tant que j2 est inférieur à abscisse k
				{
					k2 = k2 + 1;
				}
			y2 =((sim.univ.y[k2+1]-sim.univ.y[k2])/(sim.univ.x[k2+1]-sim.univ.x[k2]))*(sim.shad2.xdeb + i*sim.shad2.dx) + (sim.univ.y[k2]-((sim.univ.y[k2+1]-sim.univ.y[k2])/(sim.univ.x[k2+1]-sim.univ.x[k2]))*sim.univ.x[k2]); //ax + b 
			if (sim.shad2.ydeb + i2*sim.shad2.dy > y2)
			{
				sim.shad2.xfin = sim.shad2.xdeb + i2*sim.shad2.dx;
				sim.shad2.yfin = sim.shad2.ydeb + i2*sim.shad2.dy + 1;
				i2 = i2 +1;
			}
			else{
				sim.shad2.vy = 0;
				i2 = n2 + 1;
			}
			k=0;
		}
		sim.shad2.x = sim.shad2.xfin;
		sim.shad2.y = sim.shad2.yfin;
		//on impose une vitesse limite pour shad1
		if (sim.shad1.vx > 20)
		{
			sim.shad1.vx = 20;
		}
		if (sim.shad1.vx < -20)
		{
			sim.shad1.vx = -20;
		}
		//on impose une vitesse limite pour shad2
		if (sim.shad2.vx > 20)
		{
			sim.shad2.vx = 20;
		}
		if (sim.shad2.vx < -20)
		{
			sim.shad2.vx = -20;
		}
		
		//on empeche les shadocks de sortir du monde
		if (sim.shad1.y <= 0){
			sim.shad1.y = 20;
			sim.shad1.vy = 20;
		}
		if (sim.shad2.y <= 0){
			sim.shad2.y = 20;
			sim.shad2.vy = 0;
		}
		// on empeche les shad de bouger si ils mettent un coup dépee
		if (sim.shad1.coup == 1)
		{
			sim.shad1.vx = 0;
		}
		//on inverse le repère
		sim.shad1.i_y = document.getElementById("canvasId").height - sim.shad1.y;
		sim.shad2.i_y = document.getElementById("canvasId").height - sim.shad2.y;
    }
  //******************* fin definition des fonctions**************  
  //************************************************************** 
  //	debutdu code exécuté au chargement de la page
  //**************************************************************
  
  var monCanevas = document.getElementById("canvasId");
  // tout est mis dans un if getContext de monCanevas afin d'éviter les plantage si canvas n'est pas géré par le navigateur
  if (monCanevas.getContext){

    var context= monCanevas.getContext("2d"); 
 
     
    // instancie(construit) un jeu  nommé  j
    var sim = new ClasseSimulateur();
    
    
    // definition du timer en ms et de la fonction appellée par le timer
    // ATTENTION : pas de parenthèses pour la fonction appelée
    // le jeu est redessiné toutes les 30 ms
    var myInterval = setInterval(evoluer, 50);
    // gestionnaire d'événement
    document.monForm.boutonStop.onclick=arreter;
    document.monForm.boutonEncore.onclick=relancer;
    if (sim.shad2.vivant == 1)
    {
	document.monForm.boutonDroite.onclick=allerDroite2;
	document.monForm.boutonGauche.onclick=allerGauche2;
	document.monForm.boutonSauter.onclick=sauter2;
	document.monForm.boutonCoup.onclick=coup_epee2;
	}
	window.onkeydown = function(event) {
		if (sim.shad1.vivant == 1)
		{
		    switch (event.keyCode) {
		        case 81: /* q */
		        allerGauche();
		        break;
		        case 90: /* z */ 
		        sauter();
		        case 68: /* d */
		        allerDroite();
		        break;
		        case 65: /* a */
		        coup_epee();
		        break;
				}
		}
  }     // fin de   if (monCanevas.getContext)
   
}    //   fin de window.onload = function()

}

-->    
</script>
</head>
<body>
  <canvas id="canvasId" width="1000" height="600" name="monCanevas">
	  Texte si navigateur ne supporte pas la balise Canvas
  </canvas>
  <form name="monForm">	  
      <div id="s1">score j1 <h1 id="score1"></h1></div><br> 
      <div id="s2">score j2 <h1 id="score2"></h1></div><br>
      <div id="rs1"><br/></div>
      <div id="rs2"><br/></div>
      <input value="Stop" name="boutonStop" type="button" >     
      <input value="Encore" name="boutonEncore" type="button" > <br/>
	  <input value="sauter" name="boutonSauter" type="button" >  <br/>
	  <input value="gauche" name="boutonGauche" type="button" > 
	  <input value="droite" name="boutonDroite" type="button" > <br/>
	  <input value="coup" name="boutonCoup" type="button" > 
  </form>
  <img id="sprite" width="220" height="277" src="ressources/images/sprites.png" alt="sprite" style="display: none;">
  <img id="sprite_reverse" width="220" height="277" src="ressources/images/sprites_reverse.png" alt="sprite"  style="display: none;">
  <img id="sprites_static" width="220" height="277" src="ressources/images/sprites_static.png" alt="sprite"  style="display: none;">
  <img id="sprites_static_reverse" width="220" height="277" src="ressources/images/sprites_static_reverse.png" alt="sprite"  style="display: none;">
  <img id="sprite_epee" width="220" height="277" src="ressources/images/sprite_sword.png" alt="sprite"  style="display: none;">
  <img id="epee" width="220" height="277" src="ressources/images/sword.png" alt="sprite"  style="display: none;">
  <img id="sprite_epee_reverse" width="220" height="277" src="ressources/images/sprite_sword_reverse.png" alt="sprite"  style="display: none;">
  <img id="epee_reverse" width="220" height="277" src="ressources/images/sword_reverse.png" alt="sprite"  style="display: none;">
  <audio id="debut_sl" >
  		<source src="ressources/son/debut_sl.wav">
  </audio>
  <audio id="fin_sl" >
  		<source src="ressources/son/fin_sl.wav">
  </audio>
  <audio id="sl" >
  		<source src="ressources/son/sl.wav">
  </audio>
</html>
